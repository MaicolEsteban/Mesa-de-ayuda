<div class="manage-users-container">
  <nav class="navbar">
    <h1>Mesa Digital - Gestionar Usuarios</h1>
    <div class="nav-right">
      <span>{{ usuario?.nombre }}</span>
      <button (click)="volver()" class="btn-back">‚Üê Volver</button>
    </div>
  </nav>

  <div class="content">
    <!-- MENSAJES DE √âXITO Y ERROR -->
    <div *ngIf="mensajeExito" class="alert alert-success">{{ mensajeExito }}</div>
    <div *ngIf="mensajeError" class="alert alert-error">{{ mensajeError }}</div>

    <!-- SECCI√ìN DE CREAR USUARIO -->
    <div class="crear-usuario-section">
      <h2>‚ûï Crear Nuevo Usuario</h2>
      
      <!-- SELECTOR DE TIPO DE USUARIO -->
      <div class="tipo-selector">
        <label>¬øQu√© tipo de usuario deseas crear?</label>
        <div class="botones-tipo">
          <button 
            (click)="tipoCrear = 'ESTUDIANTE'" 
            [class.activo]="tipoCrear === 'ESTUDIANTE'"
            class="btn-tipo">
            üéì Estudiante
          </button>
          <button 
            (click)="tipoCrear = 'REVISOR'" 
            [class.activo]="tipoCrear === 'REVISOR'"
            class="btn-tipo">
            üë§ Revisor
          </button>
          <button 
            (click)="tipoCrear = 'ADMINISTRADOR'" 
            [class.activo]="tipoCrear === 'ADMINISTRADOR'"
            class="btn-tipo">
            üë®‚Äçüíº Administrador
          </button>
        </div>
      </div>

      <!-- FORMULARIO PARA ESTUDIANTE -->
      <div *ngIf="tipoCrear === 'ESTUDIANTE'" class="formulario-estudiante">
        <h3>üéì Crear Estudiante</h3>
        <form (ngSubmit)="crearEstudiante()">
          <div class="form-group">
            <label>Email *</label>
            <input 
              type="email" 
              [(ngModel)]="nuevoEstudiante.email" 
              name="email"
              placeholder="ejemplo@unipanamericana.edu.co"
              required>
          </div>

          <div class="form-group">
            <label>Nombre Completo *</label>
            <input 
              type="text" 
              [(ngModel)]="nuevoEstudiante.nombre" 
              name="nombre"
              placeholder="Juan P√©rez Garc√≠a"
              required>
          </div>

          <div class="form-group">
            <label>C√©dula *</label>
            <input 
              type="text" 
              [(ngModel)]="nuevoEstudiante.cedula" 
              name="cedula"
              placeholder="1234567890"
              required>
          </div>

          <div class="form-group">
            <label>Carrera/Facultad *</label>
            <select 
              [(ngModel)]="nuevoEstudiante.facultad" 
              name="facultad"
              required>
              <option value="">-- Selecciona una carrera --</option>
              <option *ngFor="let fac of facultades" [value]="fac">{{ fac }}</option>
            </select>
          </div>

          <div class="form-group">
            <label>Contrase√±a *</label>
            <input 
              type="password" 
              [(ngModel)]="nuevoEstudiante.contrasena" 
              name="contrasena"
              placeholder="Ingresa una contrase√±a segura"
              required>
          </div>

          <div class="form-actions">
            <button 
              type="submit" 
              [disabled]="cargando"
              class="btn btn-primary">
              {{ cargando ? 'Creando...' : '‚úì Crear Estudiante' }}
            </button>
            <button 
              type="button" 
              (click)="limpiarFormularios()"
              class="btn btn-secondary">
              Limpiar
            </button>
          </div>
        </form>
      </div>

      <!-- FORMULARIO PARA REVISOR O ADMINISTRADOR -->
      <div *ngIf="tipoCrear === 'REVISOR' || tipoCrear === 'ADMINISTRADOR'" class="formulario-general">
        <h3>{{ tipoCrear === 'REVISOR' ? 'üë§ Crear Revisor' : 'üë®‚Äçüíº Crear Administrador' }}</h3>
        <form (ngSubmit)="crearUsuario()">
          <div class="form-group">
            <label>Email *</label>
            <input 
              type="email" 
              [(ngModel)]="nuevoUsuario.email" 
              name="email"
              placeholder="ejemplo@unipanamericana.edu.co"
              required>
          </div>

          <div class="form-group">
            <label>Nombre Completo *</label>
            <input 
              type="text" 
              [(ngModel)]="nuevoUsuario.nombre" 
              name="nombre"
              placeholder="Juan P√©rez Garc√≠a"
              required>
          </div>

          <div class="form-group">
            <label>C√©dula *</label>
            <input 
              type="text" 
              [(ngModel)]="nuevoUsuario.cedula" 
              name="cedula"
              placeholder="1234567890"
              required>
          </div>

          <div class="form-group">
            <label>Contrase√±a *</label>
            <input 
              type="password" 
              [(ngModel)]="nuevoUsuario.contrasena" 
              name="contrasena"
              placeholder="Ingresa una contrase√±a segura"
              required>
          </div>

          <div class="form-group">
            <label>Tipo de Usuario *</label>
            <select 
              [(ngModel)]="nuevoUsuario.tipoUsuario" 
              name="tipoUsuario"
              required>
              <option value="">-- Selecciona tipo --</option>
              <option value="REVISOR">REVISOR</option>
              <option value="PERSONAL">ADMINISTRADOR</option>
            </select>
          </div>

          <div class="form-group">
            <label>Rol *</label>
            <select 
              [(ngModel)]="nuevoUsuario.rol" 
              name="rol"
              required>
              <option value="">-- Selecciona rol --</option>
              <option value="ROL_REVISOR" *ngIf="tipoCrear === 'REVISOR'">ROL_REVISOR</option>
              <option value="ROL_ADMIN" *ngIf="tipoCrear === 'ADMINISTRADOR'">ROL_ADMIN</option>
            </select>
          </div>

          <div class="form-actions">
            <button 
              type="submit" 
              [disabled]="cargando"
              class="btn btn-primary">
              {{ cargando ? 'Creando...' : '‚úì Crear ' + tipoCrear }}
            </button>
            <button 
              type="button" 
              (click)="limpiarFormularios()"
              class="btn btn-secondary">
              Limpiar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- SECCI√ìN DE LISTA DE USUARIOS -->
    <div class="usuarios-section">
      <h2>üë• Usuarios Registrados</h2>

      <!-- FILTROS -->
      <div class="filtros">
        <input 
          type="text" 
          [(ngModel)]="filtroEmail"
          (ngModelChange)="aplicarFiltros()"
          placeholder="Buscar por email..."
          class="filtro-input">

        <select 
          [(ngModel)]="filtroTipo"
          (ngModelChange)="aplicarFiltros()"
          class="filtro-select">
          <option value="">-- Todos los tipos --</option>
          <option value="ESTUDIANTE">ESTUDIANTE</option>
          <option value="REVISOR">REVISOR</option>
          <option value="PERSONAL">ADMINISTRADOR</option>
        </select>
      </div>

      <!-- TABLA DE USUARIOS -->
      <div class="usuarios-tabla">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Email</th>
              <th>Nombre</th>
              <th>Tipo</th>
              <th>C√©dula</th>
              <th>Facultad</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of usuariosFiltrados">
              <td>{{ user.id }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.nombre }}</td>
              <td>
                <span class="badge" [ngClass]="{
                  'badge-student': user.tipoUsuario === 'ESTUDIANTE',
                  'badge-revisor': user.tipoUsuario === 'REVISOR',
                  'badge-admin': user.tipoUsuario === 'PERSONAL'
                }">
                  {{ user.tipoUsuario }}
                </span>
              </td>
              <td>{{ user.cedula || '-' }}</td>
              <td>{{ user.facultad || '-' }}</td>
              <td>
                <button 
                  (click)="editarUsuario(user)"
                  class="btn-accion btn-edit"
                  title="Editar">
                  ‚úèÔ∏è
                </button>
                <button 
                  (click)="eliminarUsuario(user.id)"
                  class="btn-accion btn-delete"
                  title="Eliminar">
                  üóëÔ∏è
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        
        <div *ngIf="usuariosFiltrados.length === 0" class="no-usuarios">
          <p>No hay usuarios que coincidan con los filtros</p>
        </div>

        <div class="usuarios-resumen">
          <p>Total de usuarios: <strong>{{ usuariosFiltrados.length }}</strong></p>
        </div>
      </div>
      <div *ngIf="mostrarModalEdicion" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h2>‚úèÔ∏è Editar Usuario</h2>
      <button class="btn-close" (click)="cerrarModalEdicion()">‚úï</button>
    </div>

    <div class="modal-body">
      <form>
        <div class="form-group">
          <label>Email (No editable)</label>
          <input type="email" class="form-control" [value]="usuarioEnEdicion?.email" readonly>
        </div>

        <div class="form-group">
          <label>Nombre</label>
          <input type="text" class="form-control" [(ngModel)]="usuarioEnEdicion.nombre" name="nombre">
        </div>

        <div class="form-group">
          <label>C√©dula</label>
          <input type="text" class="form-control" [(ngModel)]="usuarioEnEdicion.cedula" name="cedula">
        </div>

        <div class="form-group" *ngIf="usuarioEnEdicion?.tipoUsuario === 'ESTUDIANTE'">
          <label>Facultad</label>
          <select class="form-control" [(ngModel)]="usuarioEnEdicion.facultad" name="facultad">
            <option value="">-- Selecciona facultad --</option>
            <option *ngFor="let fac of facultades" [value]="fac">{{ fac }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Contrase√±a (Dejar en blanco para no cambiar)</label>
          <input type="password" class="form-control" [(ngModel)]="usuarioEnEdicion.contrasena" name="contrasena" placeholder="Nueva contrase√±a (opcional)">
        </div>

        <div *ngIf="mensajeError" class="alert alert-error">
          {{ mensajeError }}
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cerrarModalEdicion()">Cancelar</button>
      <button class="btn btn-primary" (click)="guardarEdicion()" [disabled]="cargando">
        {{ cargando ? 'Guardando...' : 'Guardar Cambios' }}
      </button>
    </div>
  </div>
</div>
    </div>
  </div>
  </div>

<!-- ‚≠ê MODAL DE EDICI√ìN - AGREGAR ESTO AL FINAL -->

